<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ET Panthiya.lk Quiz Portal</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #560bad;
            --danger: #e63946;
            --radius: 12px;
            --shadow: 0 10px 20px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: var(--light);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* Particle Background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Day Greeting */
        .day-greeting {
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Header Section */
        .header {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.8), rgba(63, 55, 201, 0.9));
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            z-index: 10;
            backdrop-filter: blur(5px);
            border-bottom: 1px solid var(--glass-border);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://etpanthiya.lk/wp-content/uploads/2023/05/etp-logo.png') no-repeat center center;
            background-size: cover;
            opacity: 0.1;
            z-index: -1;
        }

        .profile-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: white;
            margin: 0 auto 1rem;
            overflow: hidden;
            border: 5px solid white;
            box-shadow: var(--shadow);
            position: relative;
            animation: float 6s ease-in-out infinite;
        }

        .profile-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            animation: fadeInDown 1s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 1.5rem;
            animation: fadeIn 1.5s ease;
        }

        .btn {
            padding: 0.8rem 1.8rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            border: none;
            outline: none;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-primary {
            background-color: white;
            color: var(--primary);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background-color: var(--accent);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary);
            transform: translateY(-3px);
        }

        .btn-whatsapp {
            background-color: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background-color: #128C7E;
            transform: translateY(-3px);
        }

        /* Notice Section */
        .notice-section {
            background-color: var(--glass);
            backdrop-filter: blur(10px);
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--warning);
            animation: slideInUp 1s ease;
            border: 1px solid var(--glass-border);
        }

        .notice-title {
            color: var(--warning);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notice-content {
            line-height: 1.6;
        }

        /* Lessons Grid */
        .lessons-container {
            padding: 2rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
            color: white;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Montserrat', sans-serif;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 2px;
        }

        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .lesson-card {
            background-color: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            transform: translateY(0);
            border: 1px solid var(--glass-border);
        }

        .lesson-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .lesson-image {
            height: 180px;
            width: 100%;
            object-fit: cover;
        }

        .lesson-content {
            padding: 1.5rem;
        }

        .lesson-title {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .lesson-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }

        .lesson-levels {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .level-btn {
            padding: 0.4rem 0.8rem;
            background-color: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            outline: none;
            color: white;
        }

        .level-btn:hover {
            background-color: var(--accent);
            color: white;
        }

        .level-btn.active {
            background-color: var(--primary);
            color: white;
        }

        /* Floating Action Buttons */
        .fab-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            border: none;
            outline: none;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        .fab-whatsapp {
            background-color: #25D366;
        }

        .fab-papers {
            background-color: var(--info);
        }

        .fab-menu {
            background-color: var(--dark);
        }

        .fab-dropdown {
            position: absolute;
            bottom: 70px;
            right: 0;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transform: scale(0);
            transform-origin: bottom right;
            transition: var(--transition);
            opacity: 0;
        }

        .fab-dropdown.show {
            transform: scale(1);
            opacity: 1;
        }

        .fab-item {
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            text-decoration: none;
            color: var(--dark);
            transition: var(--transition);
            white-space: nowrap;
        }

        .fab-item:hover {
            background-color: var(--light);
        }

        /* Modal Styles - Updated Modern Design */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            align-items: flex-start; /* Changed from center to flex-start */
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(5px);
            overflow-y: auto; /* Added for scrollable modals */
            padding: 20px 0; /* Added padding for mobile */
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: translateY(20px);
            transition: var(--transition);
            position: relative;
            border: none;
            margin: auto; /* Center vertically */
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: var(--radius) var(--radius) 0 0;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: white;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
            transition: var(--transition);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }

        .modal-body {
            padding: 1.5rem;
            color: #333;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-family: inherit;
            transition: var(--transition);
            background-color: #f9f9f9;
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
            background-color: white;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            position: sticky;
            bottom: 0;
            background-color: white;
            z-index: 10;
        }

        /* Quiz Modal - Updated with Close Button */
        .quiz-modal {
            max-width: 100%;
            width: 100%;
            height: 100%;
            position: relative;
            margin: 0;
            border-radius: 0;
        }

        .quiz-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem;
            position: relative;
        }

        .quiz-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .quiz-level {
            opacity: 0.9;
        }

        .quiz-iframe {
            width: 100%;
            height: calc(100vh - 100px);
            border: none;
            background-color: white;
        }

        .quiz-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            z-index: 10;
        }

        .quiz-close-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        /* SMS Verification Modal - Updated Design */
        .verification-modal .modal-content {
            max-width: 400px;
            margin: 20px auto; /* Changed from fixed position to auto margin */
            transform: none; /* Removed transform */
        }

        .verification-code-inputs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .verification-code-input {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            transition: var(--transition);
        }

        .verification-code-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            background-color: white;
        }

        .resend-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
            font-weight: 600;
        }

        .resend-btn.active {
            display: inline;
        }

        .countdown {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Student Info Form - Updated Design */
        .student-form .form-group {
            margin-bottom: 1rem;
        }

        .student-form label {
            font-size: 0.9rem;
            color: #555;
        }

        /* Terms Modal - Updated Design */
        .terms-modal .modal-content {
            max-height: 70vh;
            overflow-y: auto;
        }

        .terms-content {
            padding: 1.5rem;
            color: #333;
        }

        .terms-content h4 {
            color: var(--primary);
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .terms-content p {
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .terms-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            background-color: #f9f9f9;
            border-radius: 0 0 var(--radius) var(--radius);
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.8rem;
            background-color: #f5f5f5;
            border-radius: var(--radius);
        }

        .terms-checkbox input {
            accent-color: var(--primary);
        }

        /* Mandatory Notice Modal */
        .mandatory-notice-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .mandatory-notice-content {
            background-color: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .mandatory-notice-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--warning), #f55b9a);
            color: white;
            text-align: center;
        }

        .mandatory-notice-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .mandatory-notice-body {
            padding: 1.5rem;
            color: #333;
            line-height: 1.6;
        }

        .mandatory-notice-footer {
            padding: 1rem;
            display: flex;
            justify-content: center;
            background-color: #f9f9f9;
        }

        .mandatory-notice-btn {
            padding: 0.8rem 2rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .mandatory-notice-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        /* Loading Spinner */
        .spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .spinner.show {
            display: flex;
        }

        .spinner-circle {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            bottom: 3rem;
        }

        .toast.success {
            background-color: #28a745;
        }

        .toast.error {
            background-color: #dc3545;
        }

        .toast.warning {
            background-color: #ffc107;
            color: var(--dark);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 5px;
            background-color: rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1001;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Header Buttons */
        .header-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
        }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .lessons-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .fab-container {
                bottom: 1rem;
                right: 1rem;
            }

            .quiz-iframe {
                height: calc(100vh - 100px);
            }

            /* Mobile-specific modal adjustments */
            .modal {
                padding: 10px 0;
                align-items: flex-start;
            }

            .modal-content {
                width: 95%;
                margin-top: 20px;
                margin-bottom: 20px;
            }

            .verification-code-input {
                width: 35px;
                height: 45px;
                font-size: 1.3rem;
            }
        }

        @media (max-width: 480px) {
            .profile-circle {
                width: 100px;
                height: 100px;
            }

            .verification-code-input {
                width: 30px;
                height: 40px;
                font-size: 1.2rem;
            }

            .header-buttons {
                max-width: 100%;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div id="particles-js"></div>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Loading Spinner -->
    <div class="spinner" id="spinner">
        <div class="spinner-circle"></div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Header Section -->
    <header class="header">
        <div class="day-greeting" id="dayGreeting">
            <i class="fas fa-sun"></i>
            <span id="greetingText">Good Morning</span>
        </div>
        <div class="profile-circle">
            <img src="https://etpanthiya.lk/wp-content/uploads/2023/05/etp-logo.png" alt="Tutor">
        </div>
        <h1 class="title">ET Panthiya.lk Quiz Portal</h1>
        <p class="subtitle">Test your knowledge and improve your engineering technology skills with our interactive quiz portal. Complete lessons, track progress, and become an expert!</p>
        
        <div class="header-buttons">
            <a href="https://etpanthiya.lk" class="btn btn-primary">
                <i class="fas fa-globe"></i> Visit ET Panthiya.lk
            </a>
            <a href="https://chat.whatsapp.com/yourgroup" class="btn btn-whatsapp">
                <i class="fab fa-whatsapp"></i> Join WhatsApp Group
            </a>
        </div>
    </header>

    <!-- Notice Section -->
    <section class="notice-section">
        <h3 class="notice-title"><i class="fas fa-exclamation-circle"></i> Important Notice</h3>
        <p class="notice-content">
            Welcome to the ET Panthiya Quiz Portal! Complete our quick registration process to access all quiz levels. 
            You'll need to verify your phone number and provide some basic information before starting your first quiz.
        </p>
    </section>

    <!-- Lessons Grid -->
    <section class="lessons-container">
        <h2 class="section-title">Available Lessons</h2>
        <div class="lessons-grid" id="lessonsGrid">
            <!-- Lessons will be dynamically inserted here -->
        </div>
    </section>

    <!-- Floating Action Buttons -->
    <div class="fab-container">
        <div class="fab fab-whatsapp" id="fabWhatsapp">
            <i class="fab fa-whatsapp"></i>
        </div>
        <div class="fab fab-papers" id="fabPapers">
            <i class="fas fa-book"></i>
        </div>
        <div class="fab fab-menu" id="fabMenu">
            <i class="fas fa-ellipsis-v"></i>
        </div>
        
        <div class="fab-dropdown" id="fabDropdown">
            <a href="https://etpanthiya.lk/student-portal" class="fab-item" target="_blank">
                <i class="fas fa-user-graduate"></i> Student Portal
            </a>
            <a href="https://etpanthiya.lk/feedback" class="fab-item" target="_blank">
                <i class="fas fa-comment-alt"></i> Give Feedback
            </a>
            <a href="https://etpanthiya.lk/results" class="fab-item" target="_blank">
                <i class="fas fa-chart-bar"></i> Results
            </a>
        </div>
    </div>

    <!-- Terms Modal -->
    <div class="modal terms-modal" id="termsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Terms and Conditions</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body terms-content">
                <h4>1. Acceptance of Terms</h4>
                <p>By accessing or using the ET Panthiya Quiz Portal, you agree to be bound by these Terms and Conditions.</p>
                
                <h4>2. User Responsibilities</h4>
                <p>You are responsible for maintaining the confidentiality of your account and password and for restricting access to your computer or device.</p>
                
                <h4>3. Privacy Policy</h4>
                <p>Your use of our services is also governed by our Privacy Policy, which explains how we collect, use, and protect your personal information.</p>
                
                <h4>4. Intellectual Property</h4>
                <p>All content, including quizzes, lessons, and materials on this portal, are the property of ET Panthiya and are protected by copyright laws.</p>
                
                <h4>5. Prohibited Activities</h4>
                <p>You agree not to engage in any activity that interferes with or disrupts the services or servers and networks connected to the services.</p>
                
                <h4>6. Limitation of Liability</h4>
                <p>ET Panthiya shall not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use of the services.</p>
                
                <div class="terms-checkbox">
                    <input type="checkbox" id="agreeTerms" required>
                    <label for="agreeTerms">I have read and agree to the Terms and Conditions</label>
                </div>
            </div>
            <div class="modal-footer terms-footer">
                <button class="btn btn-secondary" id="declineTermsBtn">Decline</button>
                <button class="btn btn-primary" id="acceptTermsBtn" disabled>Accept</button>
            </div>
        </div>
    </div>

    <!-- SMS Verification Modal -->
    <div class="modal verification-modal" id="verificationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Phone Verification</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="phoneNumber" class="form-label">Phone Number</label>
                    <input type="tel" id="phoneNumber" class="form-control" placeholder="Enter your phone number (94XXXXXXXXX)">
                </div>
                
                <button class="btn btn-primary" id="sendCodeBtn" style="width: 100%;">Send Verification Code</button>
                
                <div id="verificationSection" style="display: none;">
                    <p style="margin-top: 1rem; color: #333;">We've sent a 6-digit verification code to your phone number. Please enter it below:</p>
                    
                    <div class="verification-code-inputs" id="verificationInputs">
                        <input type="text" class="verification-code-input" maxlength="1" data-index="0">
                        <input type="text" class="verification-code-input" maxlength="1" data-index="1">
                        <input type="text" class="verification-code-input" maxlength="1" data-index="2">
                        <input type="text" class="verification-code-input" maxlength="1" data-index="3">
                        <input type="text" class="verification-code-input" maxlength="1" data-index="4">
                        <input type="text" class="verification-code-input" maxlength="1" data-index="5">
                    </div>
                    
                    <button class="btn btn-primary" id="verifyCodeBtn" style="width: 100%; margin-top: 1rem;">Verify</button>
                    
                    <div class="countdown" id="countdown">Resend code in 2:00</div>
                    <button class="resend-btn" id="resendBtn">Resend Code</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Info Modal -->
    <div class="modal" id="studentInfoModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Complete Your Profile</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body student-form">
                <form id="studentForm" action="https://formsubmit.co/hiranrusiru@gmail.com" method="POST">
                    <input type="hidden" name="_subject" value="New Student Registration - ET Panthiya">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="hidden" name="_next" value="https://etpanthiya.lk/thank-you">
                    <input type="hidden" name="phone" id="formPhone">
                    
                    <div class="form-group">
                        <label for="studentName">Full Name</label>
                        <input type="text" id="studentName" name="name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="school">School</label>
                        <input type="text" id="school" name="school" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="examYear">Exam Year</label>
                        <input type="number" id="examYear" name="examYear" class="form-control" min="2000" max="2030" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Gender</label>
                        <div style="display: flex; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" name="gender" value="Male" required> Male
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" name="gender" value="Female"> Female
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="district">District</label>
                        <select id="district" name="district" class="form-control" required>
                            <option value="">Select District</option>
                            <option value="Colombo">Colombo</option>
                            <option value="Gampaha">Gampaha</option>
                            <option value="Kalutara">Kalutara</option>
                            <option value="Kandy">Kandy</option>
                            <option value="Matale">Matale</option>
                            <option value="Nuwara Eliya">Nuwara Eliya</option>
                            <option value="Galle">Galle</option>
                            <option value="Matara">Matara</option>
                            <option value="Hambantota">Hambantota</option>
                            <option value="Jaffna">Jaffna</option>
                            <option value="Kilinochchi">Kilinochchi</option>
                            <option value="Mannar">Mannar</option>
                            <option value="Mullaitivu">Mullaitivu</option>
                            <option value="Vavuniya">Vavuniya</option>
                            <option value="Puttalam">Puttalam</option>
                            <option value="Kurunegala">Kurunegala</option>
                            <option value="Anuradhapura">Anuradhapura</option>
                            <option value="Polonnaruwa">Polonnaruwa</option>
                            <option value="Badulla">Badulla</option>
                            <option value="Monaragala">Monaragala</option>
                            <option value="Ratnapura">Ratnapura</option>
                            <option value="Kegalle">Kegalle</option>
                            <option value="Trincomalee">Trincomalee</option>
                            <option value="Batticaloa">Batticaloa</option>
                            <option value="Ampara">Ampara</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="whatsappNumber">WhatsApp Number</label>
                        <input type="tel" id="whatsappNumber" name="whatsappNumber" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Submit & Start Quizzes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div class="modal" id="quizModal">
        <div class="modal-content quiz-modal">
            <div class="quiz-header">
                <h3 class="quiz-title" id="quizTitle">Lesson Title</h3>
                <p class="quiz-level" id="quizLevel">Level 1</p>
                <button class="quiz-close-btn" id="quizCloseBtn">&times;</button>
            </div>
            <iframe class="quiz-iframe" id="quizIframe" src="about:blank"></iframe>
        </div>
    </div>

    <!-- Mandatory Notice Modal -->
    <div class="mandatory-notice-modal" id="mandatoryNoticeModal">
        <div class="mandatory-notice-content">
            <div class="mandatory-notice-header">
                <h3 class="mandatory-notice-title"><i class="fas fa-exclamation-triangle"></i> Important Notice</h3>
            </div>
            <div class="mandatory-notice-body">
                <p>Before starting the quiz, please note:</p>
                <ul style="margin-left: 1.5rem; margin-bottom: 1rem;">
                    <li>You have limited time to complete the quiz</li>
                    <li>Make sure you have a stable internet connection</li>
                    <li>Do not refresh the page during the quiz</li>
                    <li>All answers are final once submitted</li>
                </ul>
                <p>By proceeding, you acknowledge that you've read and understood these instructions.</p>
            </div>
            <div class="mandatory-notice-footer">
                <button class="mandatory-notice-btn" id="understandBtn">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Particles.js Library -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <script>
        // App Data
        const lessons = [
            { id: 1, title: "ET හැඳින්වීම", image: "https://source.unsplash.com/random/600x400/?engineering,technology", questions: 10 },
            { id: 2, title: "ඉංජිනේරු ඇඳීම Drawing", image: "https://source.unsplash.com/random/600x400/?drawing,technical", questions: 15 },
            { id: 3, title: "නිෂ්පාදන තාක්ෂණවේදය Production", image: "https://source.unsplash.com/random/600x400/?production,manufacturing", questions: 12 },
            { id: 4, title: "ගොඩනැගිලි තාක්ෂණවේදය", image: "https://source.unsplash.com/random/600x400/?construction,building", questions: 14 },
            { id: 5, title: "යන්ත්‍ර වල බල සම්ප්‍රේෂණය හා චලිත හැසිරීම්", image: "https://source.unsplash.com/random/600x400/?machinery,mechanical", questions: 18 },
            { id: 6, title: "ඉංජිනේරු ආරක්ෂාව Safety", image: "https://source.unsplash.com/random/600x400/?safety,helmet", questions: 10 },
            { id: 7, title: "ස්වයංචල තාක්ෂණය Automobile", image: "https://source.unsplash.com/random/600x400/?car,automobile", questions: 16 },
            { id: 8, title: "විදුලි තාක්ෂණවේදය Electrical", image: "https://source.unsplash.com/random/600x400/?electricity,wires", questions: 15 },
            { id: 9, title: "ඒකක හා මිනුම්", image: "https://source.unsplash.com/random/600x400/?measurement,tools", questions: 12 },
            { id: 10, title: "විදුලි යන්ත්‍ර හා බල පද්ධති (මෝටර් පාඩම)", image: "https://source.unsplash.com/random/600x400/?motor,engine", questions: 20 },
            { id: 11, title: "ප්‍රමිති හා පිරිවිතර", image: "https://source.unsplash.com/random/600x400/?standards,quality", questions: 10 },
            { id: 12, title: "බිම් මැනුම්", image: "https://source.unsplash.com/random/600x400/?surveying,land", questions: 14 },
            { id: 13, title: "තරල යන්‍ත්‍ර", image: "https://source.unsplash.com/random/600x400/?fluid,hydraulics", questions: 16 },
            { id: 14, title: "ඉලෙක්ට්‍රොනික් තාක්ෂණය", image: "https://source.unsplash.com/random/600x400/?electronics,circuit", questions: 18 },
            { id: 15, title: "ජල සම්පාදනය හා කසල අපහනය", image: "https://source.unsplash.com/random/600x400/?water,waste", questions: 12 },
            { id: 16, title: "ප්‍රමාණ බිල්පත් සැකසීම ඇස්තමේන්තුකරණය (TDS BOQ)", image: "https://source.unsplash.com/random/600x400/?invoice,accounting", questions: 15 },
            { id: 17, title: "ව්‍යවසායකත්වය හා කළමනාකරණය", image: "https://source.unsplash.com/random/600x400/?business,management", questions: 10 }
        ];

        const levelsPerLesson = 20;
        const googleFormsBaseUrl = "https://docs.google.com/forms/d/e/";

        // These would be replaced with actual form IDs for each level
        const formIds = Array(17).fill().map(() => 
            Array(20).fill().map(() => 
                "1FAIpQLS" + Math.random().toString(36).substring(2, 15) + "/viewform"
            )
        );

        // DOM Elements
        const lessonsGrid = document.getElementById('lessonsGrid');
        const termsModal = document.getElementById('termsModal');
        const agreeTerms = document.getElementById('agreeTerms');
        const acceptTermsBtn = document.getElementById('acceptTermsBtn');
        const declineTermsBtn = document.getElementById('declineTermsBtn');
        const verificationModal = document.getElementById('verificationModal');
        const phoneNumberInput = document.getElementById('phoneNumber');
        const sendCodeBtn = document.getElementById('sendCodeBtn');
        const verificationSection = document.getElementById('verificationSection');
        const verificationInputs = document.getElementById('verificationInputs');
        const verifyCodeBtn = document.getElementById('verifyCodeBtn');
        const resendBtn = document.getElementById('resendBtn');
        const countdown = document.getElementById('countdown');
        const studentInfoModal = document.getElementById('studentInfoModal');
        const studentForm = document.getElementById('studentForm');
        const formPhone = document.getElementById('formPhone');
        const quizModal = document.getElementById('quizModal');
        const quizTitle = document.getElementById('quizTitle');
        const quizLevel = document.getElementById('quizLevel');
        const quizIframe = document.getElementById('quizIframe');
        const quizCloseBtn = document.getElementById('quizCloseBtn');
        const fabWhatsapp = document.getElementById('fabWhatsapp');
        const fabPapers = document.getElementById('fabPapers');
        const fabMenu = document.getElementById('fabMenu');
        const fabDropdown = document.getElementById('fabDropdown');
        const progressBar = document.getElementById('progressBar');
        const spinner = document.getElementById('spinner');
        const toast = document.getElementById('toast');
        const dayGreeting = document.getElementById('dayGreeting');
        const greetingText = document.getElementById('greetingText');
        const mandatoryNoticeModal = document.getElementById('mandatoryNoticeModal');
        const understandBtn = document.getElementById('understandBtn');

        // Modal close buttons
        const modalCloseButtons = document.querySelectorAll('.modal-close');

        // App State
        let currentLesson = null;
        let currentLevel = null;
        let generatedCode = "";
        let phoneNumber = "";
        let resendAttempts = 0;
        let countdownInterval = null;
        let countdownTime = 120; // 2 minutes in seconds
        let hasCompletedRegistration = localStorage.getItem('hasCompletedRegistration') === 'true';

        // Initialize the app
        function init() {
            renderLessons();
            setupEventListeners();
            setupScrollProgress();
            setupDayGreeting();
            
            // Initialize particles.js
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 },
                    move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" }
                    }
                }
            });
        }

        // Set up day greeting
        function setupDayGreeting() {
            const hour = new Date().getHours();
            let greeting = "";
            let icon = "";
            
            if (hour < 12) {
                greeting = "Good Morning";
                icon = "fa-sun";
            } else if (hour < 18) {
                greeting = "Good Afternoon";
                icon = "fa-sun";
            } else {
                greeting = "Good Evening";
                icon = "fa-moon";
            }
            
            greetingText.textContent = greeting;
            dayGreeting.querySelector('i').className = `fas ${icon}`;
        }

        // Render lessons grid
        function renderLessons() {
            lessonsGrid.innerHTML = '';
            
            lessons.forEach(lesson => {
                const lessonCard = document.createElement('div');
                lessonCard.className = 'lesson-card';
                lessonCard.innerHTML = `
                    <img src="${lesson.image}" alt="${lesson.title}" class="lesson-image">
                    <div class="lesson-content">
                        <h3 class="lesson-title">${lesson.title}</h3>
                        <div class="lesson-meta">
                            <span><i class="fas fa-question-circle"></i> ${lesson.questions} Questions</span>
                            <span><i class="fas fa-clock"></i> 35 Minutes</span>
                        </div>
                        <div class="lesson-levels" id="levels-${lesson.id}"></div>
                    </div>
                `;
                
                lessonsGrid.appendChild(lessonCard);
                renderLevels(lesson.id);
            });
        }

        // Render levels for a lesson
        function renderLevels(lessonId) {
            const levelsContainer = document.getElementById(`levels-${lessonId}`);
            levelsContainer.innerHTML = '';
            
            for (let i = 1; i <= levelsPerLesson; i++) {
                const levelBtn = document.createElement('button');
                levelBtn.className = 'level-btn';
                levelBtn.textContent = `Level ${i}`;
                levelBtn.dataset.lesson = lessonId;
                levelBtn.dataset.level = i;
                
                levelBtn.addEventListener('click', () => handleLevelClick(lessonId, i));
                levelsContainer.appendChild(levelBtn);
            }
        }

        // Handle level click
        function handleLevelClick(lessonId, level) {
            currentLesson = lessonId;
            currentLevel = level;
            
            // Check if user has completed registration
            if (!hasCompletedRegistration) {
                // Show terms modal first
                showTermsModal();
                return;
            }
            
            // Show mandatory notice before quiz
            showMandatoryNotice();
        }

        // Show mandatory notice
        function showMandatoryNotice() {
            mandatoryNoticeModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Show quiz after notice is acknowledged
        function showQuizAfterNotice() {
            mandatoryNoticeModal.style.display = 'none';
            
            // Set quiz details
            const lesson = lessons.find(l => l.id === currentLesson);
            quizTitle.textContent = lesson.title;
            quizLevel.textContent = `Level ${currentLevel}`;
            
            // Show quiz modal
            quizModal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Load Google Form in full screen
            quizIframe.src = googleFormsBaseUrl + formIds[currentLesson-1][currentLevel-1];
        }

        // Show terms modal
        function showTermsModal() {
            termsModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // Show verification modal
        function showVerificationModal() {
            // Clear any previous inputs
            phoneNumberInput.value = '';
            const inputs = verificationInputs.querySelectorAll('.verification-code-input');
            inputs.forEach(input => input.value = '');
            
            // Reset verification section
            verificationSection.style.display = 'none';
            
            // Reset resend button
            resendAttempts = 0;
            resendBtn.classList.remove('active');
            
            // Show modal
            verificationModal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Focus phone number input
            setTimeout(() => {
                phoneNumberInput.focus();
                // Scroll modal into view on mobile
                document.querySelector('.verification-modal .modal-content').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 300);
        }

        // Start countdown timer
        function startCountdown() {
            countdownTime = 120; // 2 minutes
            updateCountdownDisplay();
            
            if (countdownInterval) clearInterval(countdownInterval);
            
            countdownInterval = setInterval(() => {
                countdownTime--;
                updateCountdownDisplay();
                
                if (countdownTime <= 0) {
                    clearInterval(countdownInterval);
                    resendBtn.classList.add('active');
                }
            }, 1000);
        }

        // Update countdown display
        function updateCountdownDisplay() {
            const minutes = Math.floor(countdownTime / 60);
            const seconds = countdownTime % 60;
            countdown.textContent = `Resend code in ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        // Show student info modal
        function showStudentInfoModal() {
            studentInfoModal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Scroll to top of form on mobile
            setTimeout(() => {
                document.querySelector('.student-form').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // Send verification code
        async function sendVerificationCode() {
            const phone = phoneNumberInput.value.trim();
            
            if (!phone || !/^94\d{9}$/.test(phone)) {
                showToast('Please enter a valid Sri Lankan phone number (94XXXXXXXXX)', 'error');
                return;
            }
            
            phoneNumber = phone;
            
            // Generate verification code
            generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log('Generated code:', generatedCode); // For testing only
            
            // Send SMS via textit.biz
            try {
                showSpinner();
                
                const message = `Your ET Panthiya verification code is: ${generatedCode}`;
                const encodedMessage = encodeURIComponent(message);
                const url = `https://www.textit.biz/sendmsg/?id=94760273554&pw=2204&to=${phone}&text=${encodedMessage}`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Failed to send SMS');
                }
                
                showToast('Verification code sent to your phone', 'success');
                verificationSection.style.display = 'block';
                startCountdown();
                
                // Focus first code input
                const inputs = verificationInputs.querySelectorAll('.verification-code-input');
                setTimeout(() => {
                    inputs[0].focus();
                    document.querySelector('.verification-modal .modal-content').scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            } catch (error) {
                console.error('Error sending verification code:', error);
                showToast('Failed to send verification code. Please try again.', 'error');
            } finally {
                hideSpinner();
            }
        }

        // Verify entered code
        function verifyCode() {
            const inputs = verificationInputs.querySelectorAll('.verification-code-input');
            let enteredCode = '';
            
            inputs.forEach(input => {
                enteredCode += input.value;
            });
            
            if (enteredCode.length !== 6) {
                showToast('Please enter a 6-digit code', 'error');
                return;
            }
            
            if (enteredCode === generatedCode) {
                clearInterval(countdownInterval);
                verificationModal.classList.remove('show');
                showToast('Phone number verified successfully!', 'success');
                
                // Show student info form
                showStudentInfoModal();
                formPhone.value = phoneNumber;
            } else {
                showToast('Invalid verification code', 'error');
            }
        }

        // Resend verification code
        function resendCode() {
            if (resendAttempts >= 3) {
                showToast('Maximum resend attempts reached', 'error');
                return;
            }
            
            resendAttempts++;
            sendVerificationCode();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Modal close buttons
            modalCloseButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('show');
                    document.body.style.overflow = '';
                });
            });
            
            // Terms modal
            agreeTerms.addEventListener('change', (e) => {
                acceptTermsBtn.disabled = !e.target.checked;
            });
            
            acceptTermsBtn.addEventListener('click', () => {
                termsModal.classList.remove('show');
                showVerificationModal();
            });
            
            declineTermsBtn.addEventListener('click', () => {
                showToast('You must accept the terms to use this service', 'error');
            });
            
            // Verification modal
            sendCodeBtn.addEventListener('click', sendVerificationCode);
            
            // Verification code inputs
            const codeInputs = verificationInputs.querySelectorAll('.verification-code-input');
            codeInputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (e.target.value.length === 1) {
                        if (index < codeInputs.length - 1) {
                            codeInputs[index + 1].focus();
                        } else {
                            verifyCodeBtn.focus();
                        }
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && e.target.value.length === 0 && index > 0) {
                        codeInputs[index - 1].focus();
                    }
                });
            });
            
            verifyCodeBtn.addEventListener('click', verifyCode);
            resendBtn.addEventListener('click', resendCode);
            
            // Student form submission
            studentForm.addEventListener('submit', (e) => {
                // Mark registration as complete
                hasCompletedRegistration = true;
                localStorage.setItem('hasCompletedRegistration', 'true');
                
                // Hide the modal
                studentInfoModal.classList.remove('show');
                document.body.style.overflow = '';
                
                // Show the quiz after notice
                showMandatoryNotice();
            });
            
            // Quiz modal close (click outside)
            quizModal.addEventListener('click', (e) => {
                if (e.target === quizModal) {
                    if (confirm('Are you sure you want to exit the quiz? Your progress will not be saved.')) {
                        quizModal.classList.remove('show');
                        document.body.style.overflow = '';
                    }
                }
            });
            
            // Quiz close button
            quizCloseBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to exit the quiz? Your progress will not be saved.')) {
                    quizModal.classList.remove('show');
                    document.body.style.overflow = '';
                }
            });
            
            // Mandatory notice button
            understandBtn.addEventListener('click', () => {
                showQuizAfterNotice();
            });
            
            // Floating action buttons
            fabWhatsapp.addEventListener('click', () => {
                window.open('https://chat.whatsapp.com/yourgroup', '_blank');
            });
            
            fabPapers.addEventListener('click', () => {
                window.open('https://etpanthiya.lk/papers', '_blank');
            });
            
            fabMenu.addEventListener('click', toggleFabDropdown);
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!fabMenu.contains(e.target) && !fabDropdown.contains(e.target)) {
                    fabDropdown.classList.remove('show');
                }
            });
        }

        // Toggle FAB dropdown
        function toggleFabDropdown() {
            fabDropdown.classList.toggle('show');
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Show loading spinner
        function showSpinner() {
            spinner.classList.add('show');
        }

        // Hide loading spinner
        function hideSpinner() {
            spinner.classList.remove('show');
        }

        // Setup scroll progress bar
        function setupScrollProgress() {
            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                progressBar.style.width = scrolled + '%';
            });
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
