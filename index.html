<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ET Panthiya.lk - Advanced Quiz Platform</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --danger: #f72585;
            --success: #4cc9f0;
            --warning: #f8961e;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --light-gray: #e9ecef;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            box-shadow: var(--box-shadow);
            position: relative;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
        }

        .logo i {
            margin-right: 10px;
            font-size: 32px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }

        .user-avatar:hover {
            transform: scale(1.1);
        }

        /* Main Content */
        .hero {
            text-align: center;
            padding: 60px 0 40px;
            background: linear-gradient(135deg, #f5f7fb 0%, #e8ecff 100%);
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            margin-bottom: 40px;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--primary);
            font-weight: 700;
        }

        .hero p {
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto 30px;
            color: var(--gray);
        }

        .cta-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 24px;
            border-radius: var(--border-radius);
            font-weight: 500;
            text-decoration: none;
            transition: var(--transition);
            border: none;
            cursor: pointer;
            font-size: 16px;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-secondary:hover {
            background-color: var(--light);
            transform: translateY(-2px);
        }

        /* Lessons Grid */
        .lessons-section {
            padding: 40px 0;
        }

        .section-title {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .section-title h2 {
            font-size: 2rem;
            color: var(--primary);
            display: inline-block;
            background: white;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        .section-title::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            z-index: 0;
        }

        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        .lesson-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            position: relative;
        }

        .lesson-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
        }

        .lesson-image {
            height: 160px;
            overflow: hidden;
        }

        .lesson-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: var(--transition);
        }

        .lesson-card:hover .lesson-image img {
            transform: scale(1.05);
        }

        .lesson-content {
            padding: 20px;
        }

        .lesson-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark);
            font-weight: 600;
        }

        .lesson-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .lesson-stats {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .progress-container {
            margin-bottom: 15px;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .progress-bar {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--primary));
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .level-selector {
            width: 100%;
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--light-gray);
            font-family: inherit;
            margin-bottom: 15px;
            background-color: white;
            cursor: pointer;
        }

        .start-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
        }

        .start-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(20px);
            transition: all 0.3s ease;
            position: relative;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--light-gray);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Terms Modal Specific */
        .terms-content {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            padding: 15px;
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }

        .terms-checkbox input {
            margin-right: 10px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
            font-family: inherit;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        /* Verification Styles */
        .verification-code-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .verification-input {
            flex: 1;
            height: 50px;
            text-align: center;
            font-size: 1.2rem;
            border: 1px solid var(--light-gray);
            border-radius: var(--border-radius);
        }

        .verification-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .resend-code {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .resend-link {
            color: var(--primary);
            cursor: pointer;
            text-decoration: none;
        }

        .resend-link:hover {
            text-decoration: underline;
        }

        /* Alert Styles */
        .alert {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success {
            background-color: rgba(76, 201, 240, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-danger {
            background-color: rgba(247, 37, 133, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .alert-warning {
            background-color: rgba(248, 150, 30, 0.1);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        /* Greeting Message */
        .greeting-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            transform: translateX(150%);
            transition: transform 0.5s ease;
        }

        .greeting-message.show {
            transform: translateX(0);
        }

        .greeting-icon {
            font-size: 1.5rem;
        }

        .greeting-text {
            font-weight: 500;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .cta-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
            
            .lessons-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .hero {
                padding: 40px 0 30px;
            }
            
            .section-title h2 {
                font-size: 1.5rem;
            }
            
            .modal {
                width: 95%;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .slide-up {
            animation: slideUp 0.5s ease forwards;
        }

        /* Loading Spinner */
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            display: inline-block;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hidden Content */
        .hidden-content {
            display: none;
        }

        /* Confirmation Dialog */
        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .confirmation-dialog.active {
            opacity: 1;
            visibility: visible;
        }

        .dialog-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 90%;
            max-width: 400px;
            padding: 25px;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .confirmation-dialog.active .dialog-content {
            transform: translateY(0);
        }

        .dialog-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--dark);
        }

        .dialog-message {
            margin-bottom: 25px;
            color: var(--gray);
        }

        .dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .dialog-btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .dialog-btn-cancel {
            background-color: var(--light-gray);
            color: var(--dark);
        }

        .dialog-btn-cancel:hover {
            background-color: #d1d5db;
        }

        .dialog-btn-confirm {
            background-color: var(--danger);
            color: white;
        }

        .dialog-btn-confirm:hover {
            background-color: #e11d48;
        }
    </style>
</head>
<body>
    <!-- Terms and Conditions Modal -->
    <div class="modal-overlay active" id="termsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Terms and Conditions</h3>
            </div>
            <div class="modal-body">
                <div class="terms-content">
                    <h4>1. Acceptance of Terms</h4>
                    <p>By accessing or using the ET Panthiya.lk platform, you agree to be bound by these Terms and Conditions. If you do not agree with any part of these terms, you must not use our services.</p>
                    
                    <h4>2. User Responsibilities</h4>
                    <p>You are responsible for maintaining the confidentiality of your account information and for all activities that occur under your account. You agree to provide accurate and complete information when registering.</p>
                    
                    <h4>3. Privacy Policy</h4>
                    <p>Your privacy is important to us. Our Privacy Policy explains how we collect, use, and protect your personal information. By using our services, you consent to our collection and use of your data as described in the Privacy Policy.</p>
                    
                    <h4>4. Intellectual Property</h4>
                    <p>All content on this platform, including quizzes, lessons, and materials, are the property of ET Panthiya.lk and are protected by copyright laws. Unauthorized use or distribution is prohibited.</p>
                    
                    <h4>5. Prohibited Activities</h4>
                    <p>You agree not to engage in any activity that may disrupt or interfere with the proper working of the platform, including hacking, spamming, or distributing malicious software.</p>
                    
                    <h4>6. Limitation of Liability</h4>
                    <p>ET Panthiya.lk shall not be liable for any indirect, incidental, special, or consequential damages resulting from the use or inability to use the service.</p>
                    
                    <h4>7. Changes to Terms</h4>
                    <p>We reserve the right to modify these terms at any time. Continued use of the service after such changes constitutes your acceptance of the new terms.</p>
                </div>
                
                <div class="terms-checkbox">
                    <input type="checkbox" id="acceptTerms">
                    <label for="acceptTerms">I accept the Terms and Conditions and Privacy Policy</label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="continueBtn" disabled>Continue</button>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Login to Your Account</h3>
                <button class="modal-close" id="loginCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="loginAlert" class="alert" style="display: none;"></div>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail" class="form-label">Email Address</label>
                        <input type="email" id="loginEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword" class="form-label">Password</label>
                        <input type="password" id="loginPassword" class="form-control" required>
                    </div>
                    <button type="submit" class="btn btn-primary" id="loginBtn">
                        <span id="loginSpinner" class="spinner" style="display: none;"></span>
                        <span id="loginText">Login</span>
                    </button>
                </form>
                <p style="text-align: center; margin-top: 15px;">Don't have an account? <a href="#" id="showSignupLink">Sign up</a></p>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal-overlay" id="signupModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Create Your Account</h3>
                <button class="modal-close" id="signupCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="signupAlert" class="alert" style="display: none;"></div>
                <form id="signupForm">
                    <div class="form-group">
                        <label for="signupEmail" class="form-label">Email Address</label>
                        <input type="email" id="signupEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword" class="form-label">Password</label>
                        <input type="password" id="signupPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" class="form-label">Confirm Password</label>
                        <input type="password" id="confirmPassword" class="form-control" required>
                    </div>
                    <button type="button" class="btn btn-primary" id="continueToDetailsBtn">Continue</button>
                </form>
            </div>
        </div>
    </div>

    <!-- User Details Modal -->
    <div class="modal-overlay" id="detailsModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Complete Your Profile</h3>
                <button class="modal-close" id="detailsCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="detailsAlert" class="alert" style="display: none;"></div>
                <form id="detailsForm">
                    <div class="form-group">
                        <label for="fullName" class="form-label">Full Name</label>
                        <input type="text" id="fullName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="school" class="form-label">School</label>
                        <input type="text" id="school" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="gender" class="form-label">Gender</label>
                        <select id="gender" class="form-control" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="district" class="form-label">District</label>
                        <input type="text" id="district" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="examYear" class="form-label">Exam Year</label>
                        <input type="number" id="examYear" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="whatsappNumber" class="form-label">WhatsApp Number (with country code)</label>
                        <input type="tel" id="whatsappNumber" class="form-control" required>
                        <small class="text-muted">Example: 94761234567</small>
                    </div>
                    <button type="button" class="btn btn-primary" id="verifyNumberBtn">Verify Number</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div class="modal-overlay" id="verificationModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Verify Your Number</h3>
                <button class="modal-close" id="verificationCloseBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="verificationAlert" class="alert" style="display: none;"></div>
                <p>We've sent a 6-digit verification code to your WhatsApp number. Please enter it below:</p>
                
                <div class="verification-code-container">
                    <input type="text" class="verification-input" maxlength="1" data-index="1">
                    <input type="text" class="verification-input" maxlength="1" data-index="2">
                    <input type="text" class="verification-input" maxlength="1" data-index="3">
                    <input type="text" class="verification-input" maxlength="1" data-index="4">
                    <input type="text" class="verification-input" maxlength="1" data-index="5">
                    <input type="text" class="verification-input" maxlength="1" data-index="6">
                </div>
                
                <div class="resend-code">
                    Didn't receive the code? <a href="#" class="resend-link" id="resendCodeBtn">Resend Code</a>
                </div>
                
                <button type="button" class="btn btn-primary" id="submitVerificationBtn" style="margin-top: 20px;">
                    <span id="verifySpinner" class="spinner" style="display: none;"></span>
                    <span id="verifyText">Verify</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Greeting Message -->
    <div class="greeting-message" id="greetingMessage">
        <i class="fas fa-smile greeting-icon"></i>
        <span class="greeting-text" id="greetingText"></span>
    </div>

    <!-- Confirmation Dialog -->
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="dialog-content">
            <h3 class="dialog-title">Are you sure?</h3>
            <p class="dialog-message">You have an ongoing quiz. If you leave now, your progress will be lost.</p>
            <div class="dialog-buttons">
                <button class="dialog-btn dialog-btn-cancel" id="cancelExitBtn">Cancel</button>
                <button class="dialog-btn dialog-btn-confirm" id="confirmExitBtn">Exit</button>
            </div>
        </div>
    </div>

    <!-- Main Content (Hidden until login) -->
    <div class="hidden-content" id="mainContent">
        <header>
            <div class="container header-content">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span>ET Panthiya.lk</span>
                </div>
                <div class="user-profile">
                    <div class="user-avatar" id="userAvatar">U</div>
                </div>
            </div>
        </header>

        <main>
            <section class="hero">
                <div class="container">
                    <h1>Welcome to ET Panthiya.lk</h1>
                    <p>Enhance your knowledge and prepare for exams with our comprehensive quiz platform. Access hundreds of questions, track your progress, and improve your skills.</p>
                    
                    <div class="cta-buttons">
                        <a href="https://wa.me/yourgroup" class="btn btn-primary" target="_blank">
                            <i class="fab fa-whatsapp"></i> Join WhatsApp Group
                        </a>
                        <a href="https://etpanthiya.lk" class="btn btn-secondary" target="_blank">
                            <i class="fas fa-globe"></i> Visit Our Website
                        </a>
                    </div>
                </div>
            </section>

            <section class="lessons-section">
                <div class="container">
                    <div class="section-title">
                        <h2>Available Lessons</h2>
                    </div>
                    
                    <div class="lessons-grid" id="lessonsGrid">
                        <!-- Lesson cards will be dynamically generated here -->
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAf1282ikjQ7MUSP4fKrGQjRTAb1kDWUV8",
            authDomain: "quiz-app-5b02d.firebaseapp.com",
            projectId: "quiz-app-5b02d",
            storageBucket: "quiz-app-5b02d.firebasestorage.app",
            messagingSenderId: "345835769588",
            appId: "1:345835769588:web:702129bc15f30f3d5f18a1"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const termsModal = document.getElementById('termsModal');
        const acceptTermsCheckbox = document.getElementById('acceptTerms');
        const continueBtn = document.getElementById('continueBtn');
        
        const loginModal = document.getElementById('loginModal');
        const loginCloseBtn = document.getElementById('loginCloseBtn');
        const loginForm = document.getElementById('loginForm');
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const loginBtn = document.getElementById('loginBtn');
        const loginSpinner = document.getElementById('loginSpinner');
        const loginText = document.getElementById('loginText');
        const loginAlert = document.getElementById('loginAlert');
        
        const signupModal = document.getElementById('signupModal');
        const signupCloseBtn = document.getElementById('signupCloseBtn');
        const signupForm = document.getElementById('signupForm');
        const signupEmail = document.getElementById('signupEmail');
        const signupPassword = document.getElementById('signupPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const continueToDetailsBtn = document.getElementById('continueToDetailsBtn');
        const signupAlert = document.getElementById('signupAlert');
        const showSignupLink = document.getElementById('showSignupLink');
        
        const detailsModal = document.getElementById('detailsModal');
        const detailsCloseBtn = document.getElementById('detailsCloseBtn');
        const detailsForm = document.getElementById('detailsForm');
        const fullName = document.getElementById('fullName');
        const school = document.getElementById('school');
        const gender = document.getElementById('gender');
        const district = document.getElementById('district');
        const examYear = document.getElementById('examYear');
        const whatsappNumber = document.getElementById('whatsappNumber');
        const verifyNumberBtn = document.getElementById('verifyNumberBtn');
        const detailsAlert = document.getElementById('detailsAlert');
        
        const verificationModal = document.getElementById('verificationModal');
        const verificationCloseBtn = document.getElementById('verificationCloseBtn');
        const verificationInputs = document.querySelectorAll('.verification-input');
        const submitVerificationBtn = document.getElementById('submitVerificationBtn');
        const resendCodeBtn = document.getElementById('resendCodeBtn');
        const verificationAlert = document.getElementById('verificationAlert');
        const verifySpinner = document.getElementById('verifySpinner');
        const verifyText = document.getElementById('verifyText');
        
        const mainContent = document.getElementById('mainContent');
        const greetingMessage = document.getElementById('greetingMessage');
        const greetingText = document.getElementById('greetingText');
        const userAvatar = document.getElementById('userAvatar');
        const lessonsGrid = document.getElementById('lessonsGrid');
        
        const confirmationDialog = document.getElementById('confirmationDialog');
        const cancelExitBtn = document.getElementById('cancelExitBtn');
        const confirmExitBtn = document.getElementById('confirmExitBtn');

        // Global variables
        let generatedCode = "";
        let currentUser = null;
        let verificationAttempts = 0;
        const MAX_VERIFICATION_ATTEMPTS = 3;

        // Sample lessons data (replace with your actual data)
        const lessons = [
            { id: 1, title: "Mathematics", image: "https://source.unsplash.com/random/400x300/?math", questions: 150, completed: 0 },
            { id: 2, title: "Science", image: "https://source.unsplash.com/random/400x300/?science", questions: 120, completed: 0 },
            { id: 3, title: "History", image: "https://source.unsplash.com/random/400x300/?history", questions: 90, completed: 0 },
            { id: 4, title: "English", image: "https://source.unsplash.com/random/400x300/?english", questions: 110, completed: 0 },
            { id: 5, title: "Sinhala", image: "https://source.unsplash.com/random/400x300/?sinhala", questions: 80, completed: 0 },
            { id: 6, title: "Buddhism", image: "https://source.unsplash.com/random/400x300/?buddhism", questions: 70, completed: 0 },
            { id: 7, title: "Geography", image: "https://source.unsplash.com/random/400x300/?geography", questions: 85, completed: 0 },
            { id: 8, title: "ICT", image: "https://source.unsplash.com/random/400x300/?computer", questions: 95, completed: 0 },
            { id: 9, title: "Commerce", image: "https://source.unsplash.com/random/400x300/?commerce", questions: 65, completed: 0 },
            { id: 10, title: "Agriculture", image: "https://source.unsplash.com/random/400x300/?agriculture", questions: 60, completed: 0 },
            { id: 11, title: "Art", image: "https://source.unsplash.com/random/400x300/?art", questions: 55, completed: 0 },
            { id: 12, title: "Drama", image: "https://source.unsplash.com/random/400x300/?drama", questions: 50, completed: 0 },
            { id: 13, title: "Music", image: "https://source.unsplash.com/random/400x300/?music", questions: 45, completed: 0 },
            { id: 14, title: "Dancing", image: "https://source.unsplash.com/random/400x300/?dancing", questions: 40, completed: 0 },
            { id: 15, title: "Health", image: "https://source.unsplash.com/random/400x300/?health", questions: 75, completed: 0 },
            { id: 16, title: "Life Skills", image: "https://source.unsplash.com/random/400x300/?life", questions: 60, completed: 0 },
            { id: 17, title: "Citizenship", image: "https://source.unsplash.com/random/400x300/?citizenship", questions: 50, completed: 0 }
        ];

        // Event Listeners
        acceptTermsCheckbox.addEventListener('change', function() {
            continueBtn.disabled = !this.checked;
        });

        continueBtn.addEventListener('click', function() {
            termsModal.classList.remove('active');
            loginModal.classList.add('active');
        });

        loginCloseBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // Prevent closing - user must login
            showAlert(loginAlert, 'You must login to access the platform', 'danger');
        });

        signupCloseBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // Prevent closing - user must complete signup
            showAlert(signupAlert, 'You must complete the signup process', 'danger');
        });

        detailsCloseBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // Prevent closing - user must complete profile
            showAlert(detailsAlert, 'You must complete your profile', 'danger');
        });

        verificationCloseBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // Prevent closing - user must verify number
            showAlert(verificationAlert, 'You must verify your number to continue', 'danger');
        });

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            loginUser();
        });

        showSignupLink.addEventListener('click', function(e) {
            e.preventDefault();
            loginModal.classList.remove('active');
            signupModal.classList.add('active');
        });

        continueToDetailsBtn.addEventListener('click', function() {
            if (signupPassword.value !== confirmPassword.value) {
                showAlert(signupAlert, 'Passwords do not match', 'danger');
                return;
            }
            
            if (signupPassword.value.length < 6) {
                showAlert(signupAlert, 'Password must be at least 6 characters', 'danger');
                return;
            }
            
            signupModal.classList.remove('active');
            detailsModal.classList.add('active');
        });

        verifyNumberBtn.addEventListener('click', function() {
            if (!detailsForm.checkValidity()) {
                showAlert(detailsAlert, 'Please fill all required fields', 'danger');
                return;
            }
            
            const phoneNumber = whatsappNumber.value.trim();
            if (!phoneNumber) {
                showAlert(detailsAlert, 'Please enter your WhatsApp number', 'danger');
                return;
            }
            
            // Validate phone number format
            if (!/^\d+$/.test(phoneNumber)) {
                showAlert(detailsAlert, 'Phone number should contain only digits', 'danger');
                return;
            }
            
            detailsModal.classList.remove('active');
            verificationModal.classList.add('active');
            
            // Send verification code
            sendVerificationCode(phoneNumber);
        });

        // Verification input handling
        verificationInputs.forEach(input => {
            input.addEventListener('input', function() {
                const nextIndex = parseInt(this.dataset.index) + 1;
                if (this.value.length === 1 && nextIndex <= 6) {
                    document.querySelector(`.verification-input[data-index="${nextIndex}"]`).focus();
                }
            });
            
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value.length === 0) {
                    const prevIndex = parseInt(this.dataset.index) - 1;
                    if (prevIndex >= 1) {
                        document.querySelector(`.verification-input[data-index="${prevIndex}"]`).focus();
                    }
                }
            });
        });

        submitVerificationBtn.addEventListener('click', function() {
            verifyCode();
        });

        resendCodeBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const phoneNumber = whatsappNumber.value.trim();
            sendVerificationCode(phoneNumber);
            showAlert(verificationAlert, 'New verification code sent', 'success');
        });

        // Functions
        function showAlert(element, message, type) {
            element.textContent = message;
            element.className = `alert alert-${type}`;
            element.style.display = 'flex';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }

        function loginUser() {
            const email = loginEmail.value.trim();
            const password = loginPassword.value.trim();
            
            loginBtn.disabled = true;
            loginSpinner.style.display = 'inline-block';
            loginText.textContent = 'Logging in...';
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    loginModal.classList.remove('active');
                    
                    // Show greeting message
                    showGreeting();
                    
                    // Load user data and show main content
                    loadUserData();
                })
                .catch((error) => {
                    let errorMessage = 'Login failed. Please try again.';
                    if (error.code === 'auth/user-not-found') {
                        errorMessage = 'User not found. Please sign up.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Incorrect password. Please try again.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Too many attempts. Please try again later.';
                    }
                    
                    showAlert(loginAlert, errorMessage, 'danger');
                })
                .finally(() => {
                    loginBtn.disabled = false;
                    loginSpinner.style.display = 'none';
                    loginText.textContent = 'Login';
                });
        }

        function sendVerificationCode(phoneNumber) {
            submitVerificationBtn.disabled = true;
            verifySpinner.style.display = 'inline-block';
            verifyText.textContent = 'Sending...';
            
            // Your TextIt.biz credentials
            const TEXTIT_ID = "94769343928";  // Your registered phone number
            const TEXTIT_PW = "9694";        // Your password
            
            // Generate a 6-digit random code
            generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
            
            // Prepare message (URL encoded)
            const message = `Your+verification+code+is:+${generatedCode}`;
            
            // Build the API URL
            const apiUrl = `https://www.textit.biz/sendmsg/?id=${TEXTIT_ID}&pw=${TEXTIT_PW}&to=${phoneNumber}&text=${message}`;
            
            // Make the API call
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`SMS gateway error: ${response.status}`);
                    }
                    return response.text();
                })
                .then(responseText => {
                    // Check for success response (TextIt.biz returns "OK" on success)
                    if (responseText.includes("OK")) {
                        showAlert(verificationAlert, `Verification code sent to ${phoneNumber}`, 'success');
                    } else {
                        throw new Error(responseText);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showAlert(verificationAlert, "Failed to send verification code. Please try again.", 'danger');
                })
                .finally(() => {
                    submitVerificationBtn.disabled = false;
                    verifySpinner.style.display = 'none';
                    verifyText.textContent = 'Verify';
                });
        }

        function verifyCode() {
            let enteredCode = '';
            verificationInputs.forEach(input => {
                enteredCode += input.value;
            });
            
            if (enteredCode.length !== 6) {
                showAlert(verificationAlert, 'Please enter the full 6-digit code', 'danger');
                return;
            }
            
            submitVerificationBtn.disabled = true;
            verifySpinner.style.display = 'inline-block';
            verifyText.textContent = 'Verifying...';
            
            // Simulate verification (in a real app, you would verify against the generated code)
            setTimeout(() => {
                if (enteredCode === generatedCode) {
                    verificationAttempts = 0;
                    
                    // Create user account
                    createUserAccount();
                } else {
                    verificationAttempts++;
                    
                    if (verificationAttempts >= MAX_VERIFICATION_ATTEMPTS) {
                        showAlert(verificationAlert, 'Maximum attempts reached. Please try again later.', 'danger');
                        verificationModal.classList.remove('active');
                        signupModal.classList.add('active');
                    } else {
                        showAlert(verificationAlert, `Invalid code. ${MAX_VERIFICATION_ATTEMPTS - verificationAttempts} attempts remaining.`, 'danger');
                    }
                }
                
                submitVerificationBtn.disabled = false;
                verifySpinner.style.display = 'none';
                verifyText.textContent = 'Verify';
            }, 1000);
        }

        function createUserAccount() {
            const email = signupEmail.value.trim();
            const password = signupPassword.value.trim();
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    currentUser = userCredential.user;
                    
                    // Save user details to Firestore
                    return db.collection('users').doc(currentUser.uid).set({
                        name: fullName.value.trim(),
                        email: email,
                        school: school.value.trim(),
                        gender: gender.value,
                        district: district.value.trim(),
                        examYear: parseInt(examYear.value),
                        whatsappNumber: whatsappNumber.value.trim(),
                        verified: true,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        completedLessons: []
                    });
                })
                .then(() => {
                    verificationModal.classList.remove('active');
                    
                    // Show greeting message
                    showGreeting();
                    
                    // Load user data and show main content
                    loadUserData();
                })
                .catch((error) => {
                    let errorMessage = 'Account creation failed. Please try again.';
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'Email already in use. Please login instead.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Password is too weak. Please use a stronger password.';
                    }
                    
                    showAlert(verificationAlert, errorMessage, 'danger');
                })
                .finally(() => {
                    submitVerificationBtn.disabled = false;
                    verifySpinner.style.display = 'none';
                    verifyText.textContent = 'Verify';
                });
        }

        function loadUserData() {
            if (!currentUser) return;
            
            db.collection('users').doc(currentUser.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        
                        // Update user avatar
                        if (userData.name) {
                            userAvatar.textContent = userData.name.charAt(0).toUpperCase();
                        }
                        
                        // Update completed lessons
                        if (userData.completedLessons) {
                            lessons.forEach(lesson => {
                                const completed = userData.completedLessons.filter(l => l.lessonId === lesson.id).length;
                                lesson.completed = completed;
                            });
                        }
                        
                        // Render lessons
                        renderLessons();
                        
                        // Show main content
                        mainContent.classList.remove('hidden-content');
                    }
                })
                .catch(error => {
                    console.error('Error loading user data:', error);
                });
        }

        function renderLessons() {
            lessonsGrid.innerHTML = '';
            
            lessons.forEach(lesson => {
                const progress = (lesson.completed / 20) * 100; // 20 levels per lesson
                
                const lessonCard = document.createElement('div');
                lessonCard.className = 'lesson-card slide-up';
                lessonCard.style.animationDelay = `${lesson.id * 0.1}s`;
                
                lessonCard.innerHTML = `
                    <div class="lesson-image">
                        <img src="${lesson.image}" alt="${lesson.title}">
                    </div>
                    <div class="lesson-content">
                        <h3 class="lesson-title">${lesson.title}</h3>
                        <div class="lesson-meta">
                            <span>${lesson.questions} questions</span>
                            <span>30 min</span>
                        </div>
                        <div class="progress-container">
                            <div class="progress-label">
                                <span>Progress</span>
                                <span>${lesson.completed}/20 levels</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        <select class="level-selector" id="level-${lesson.id}">
                            ${Array.from({length: 20}, (_, i) => 
                                `<option value="${i+1}" ${i+1 <= lesson.completed ? 'disabled' : ''}>
                                    Level ${i+1} ${i+1 <= lesson.completed ? '' : ''}
                                </option>`
                            ).join('')}
                        </select>
                        <button class="start-btn" id="start-${lesson.id}" ${lesson.completed >= 20 ? 'disabled' : ''}>
                            Start Quiz
                        </button>
                    </div>
                `;
                
                lessonsGrid.appendChild(lessonCard);
                
                // Add event listener for start button
                document.getElementById(`start-${lesson.id}`).addEventListener('click', function() {
                    startQuiz(lesson.id, document.getElementById(`level-${lesson.id}`).value);
                });
            });
        }

        function startQuiz(lessonId, level) {
            // Add confirmation dialog for leaving quiz
            window.addEventListener('beforeunload', confirmExit);
            
            // Show confirmation dialog if user tries to navigate away
            function confirmExit(e) {
                e.preventDefault();
                e.returnValue = '';
                confirmationDialog.classList.add('active');
            }
            
            // Handle confirmation dialog buttons
            cancelExitBtn.addEventListener('click', function() {
                confirmationDialog.classList.remove('active');
            });
            
            confirmExitBtn.addEventListener('click', function() {
                confirmationDialog.classList.remove('active');
                window.removeEventListener('beforeunload', confirmExit);
                // Redirect to Google Form or your quiz page
                // window.location.href = `https://docs.google.com/forms/d/e/YOUR_FORM_ID/viewform?usp=pp_url&entry.ENTRY_ID=${lessonId}-${level}`;
                alert(`Starting Quiz: Lesson ${lessonId}, Level ${level}`);
            });
            
            // Start the quiz immediately (in a real app, you would redirect to the quiz page)
            alert(`Starting Quiz: Lesson ${lessonId}, Level ${level}`);
        }

        function showGreeting() {
            const now = new Date();
            const hours = now.getHours();
            let greeting = '';
            
            if (hours < 12) {
                greeting = 'Good Morning';
            } else if (hours < 17) {
                greeting = 'Good Afternoon';
            } else if (hours < 20) {
                greeting = 'Good Evening';
            } else {
                greeting = 'Good Night';
            }
            
            greetingText.textContent = `${greeting}! Let's start a quiz.`;
            greetingMessage.classList.add('show');
            
            setTimeout(() => {
                greetingMessage.classList.remove('show');
            }, 5000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is already logged in
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    
                    // Show greeting message
                    showGreeting();
                    
                    // Load user data and show main content
                    loadUserData();
                } else {
                    // Show terms modal first
                    termsModal.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
