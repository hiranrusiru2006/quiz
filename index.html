<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ET Panthiya.lk Quiz Portal</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <!-- Chart.js for progress circles -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4cc9f0;
            --warning: #f72585;
            --info: #560bad;
            --danger: #e63946;
            --radius: 12px;
            --shadow: 0 10px 20px rgba(0,0,0,0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --glass: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: var(--light);
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
        }

        /* Particle Background */
        #particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Day Greeting */
        .day-greeting {
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Header Section */
        .header {
            background: linear-gradient(135deg, rgba(67, 97, 238, 0.8), rgba(63, 55, 201, 0.9));
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow);
            z-index: 10;
            backdrop-filter: blur(5px);
            border-bottom: 1px solid var(--glass-border);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://etpanthiya.lk/wp-content/uploads/2023/05/etp-logo.png') no-repeat center center;
            background-size: cover;
            opacity: 0.1;
            z-index: -1;
        }

        .profile-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: white;
            margin: 0 auto 1rem;
            overflow: hidden;
            border: 5px solid white;
            box-shadow: var(--shadow);
            position: relative;
            animation: float 6s ease-in-out infinite;
        }

        .profile-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .title {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            animation: fadeInDown 1s ease;
            font-family: 'Montserrat', sans-serif;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 1.5rem;
            animation: fadeIn 1.5s ease;
        }

        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.8rem 1.8rem;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            border: none;
            outline: none;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }

        .btn-primary {
            background-color: white;
            color: var(--primary);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background-color: var(--accent);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary);
            transform: translateY(-3px);
        }

        .btn-whatsapp {
            background-color: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background-color: #128C7E;
            transform: translateY(-3px);
        }

        /* Notice Section */
        .notice-section {
            background-color: var(--glass);
            backdrop-filter: blur(10px);
            max-width: 900px;
            margin: 2rem auto;
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--warning);
            animation: slideInUp 1s ease;
            border: 1px solid var(--glass-border);
        }

        .notice-title {
            color: var(--warning);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notice-content {
            line-height: 1.6;
        }

        /* Lessons Grid */
        .lessons-container {
            padding: 2rem 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
            color: white;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Montserrat', sans-serif;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 2px;
        }

        .lessons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .lesson-card {
            background-color: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            transform: translateY(0);
            border: 1px solid var(--glass-border);
        }

        .lesson-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }

        .lesson-image {
            height: 180px;
            width: 100%;
            object-fit: cover;
        }

        .lesson-content {
            padding: 1.5rem;
        }

        .lesson-title {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: white;
        }

        .lesson-meta {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }

        .lesson-levels {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .level-btn {
            padding: 0.4rem 0.8rem;
            background-color: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            outline: none;
            color: white;
        }

        .level-btn:hover {
            background-color: var(--accent);
            color: white;
        }

        .level-btn.completed {
            background-color: var(--success);
            color: white;
        }

        /* Progress circle container */
        .progress-container {
            width: 80px;
            height: 80px;
            margin: 0 auto 1rem;
            position: relative;
        }

        .progress-circle {
            width: 100%;
            height: 100%;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
        }

        /* Floating Action Buttons */
        .fab-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            border: none;
            outline: none;
        }

        .fab:hover {
            transform: scale(1.1);
        }

        .fab-whatsapp {
            background-color: #25D366;
        }

        .fab-papers {
            background-color: var(--info);
        }

        .fab-menu {
            background-color: var(--dark);
        }

        .fab-dropdown {
            position: absolute;
            bottom: 70px;
            right: 0;
            background-color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            transform: scale(0);
            transform-origin: bottom right;
            transition: var(--transition);
            opacity: 0;
        }

        .fab-dropdown.show {
            transform: scale(1);
            opacity: 1;
        }

        .fab-item {
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            text-decoration: none;
            color: var(--dark);
            transition: var(--transition);
            white-space: nowrap;
        }

        .fab-item:hover {
            background-color: var(--light);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transform: translateY(20px);
            transition: var(--transition);
            position: relative;
        }

        .modal.show .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--warning);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: var(--radius);
            font-family: inherit;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
            outline: none;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Quiz Modal */
        .quiz-modal {
            max-width: 800px;
        }

        .quiz-header {
            background-color: var(--primary);
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius) var(--radius) 0 0;
        }

        .quiz-title {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .quiz-level {
            opacity: 0.9;
        }

        .quiz-iframe {
            width: 100%;
            height: 100vh;
            border: none;
            background-color: white;
        }

        .quiz-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--danger);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: var(--transition);
        }

        .quiz-close-btn:hover {
            transform: scale(1.1);
        }

        /* User Details Form */
        .student-form .form-group {
            margin-bottom: 1rem;
        }

        .student-form label {
            font-size: 0.9rem;
            color: #555;
        }

        /* Verification Modal */
        .verification-modal .modal-content {
            max-width: 400px;
        }

        .verification-code-inputs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .verification-code-input {
            width: 40px;
            height: 50px;
            text-align: center;
            font-size: 1.5rem;
            border: 2px solid #ddd;
            border-radius: 5px;
        }

        .verification-code-input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .resend-btn {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .resend-btn.active {
            display: inline;
        }

        .countdown {
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* Terms Modal */
        .terms-modal {
            z-index: 2000;
        }

        .terms-content {
            max-height: 70vh;
            overflow-y: auto;
            padding: 1rem;
        }

        .terms-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terms-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        /* Quiz Notice Modal */
        .quiz-notice-modal .modal-content {
            max-width: 500px;
            text-align: center;
        }

        .quiz-notice-content {
            padding: 1.5rem;
            line-height: 1.6;
        }

        /* Loading Spinner */
        .spinner {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .spinner.show {
            display: flex;
        }

        .spinner-circle {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark);
            color: white;
            padding: 1rem 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            z-index: 1000;
            opacity: 0;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            bottom: 3rem;
        }

        .toast.success {
            background-color: #28a745;
        }

        .toast.error {
            background-color: #dc3545;
        }

        .toast.warning {
            background-color: #ffc107;
            color: var(--dark);
        }

        /* Progress Bar */
        .scroll-progress-container {
            width: 100%;
            height: 5px;
            background-color: rgba(0,0,0,0.1);
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1001;
        }

        .scroll-progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .lessons-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .fab-container {
                bottom: 1rem;
                right: 1rem;
            }
        }

        @media (max-width: 480px) {
            .header-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .profile-circle {
                width: 100px;
                height: 100px;
            }

            .modal-content {
                width: 95%;
            }

            .verification-code-input {
                width: 30px;
                height: 40px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div id="particles-js"></div>

    <!-- Scroll Progress Bar -->
    <div class="scroll-progress-container">
        <div class="scroll-progress-bar" id="scrollProgressBar"></div>
    </div>

    <!-- Loading Spinner -->
    <div class="spinner" id="spinner">
        <div class="spinner-circle"></div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Header Section -->
    <header class="header">
        <div class="day-greeting" id="dayGreeting">
            <i class="fas fa-sun"></i>
            <span id="greetingText">Good Morning</span>
        </div>
        <div class="profile-circle">
            <img src="https://etpanthiya.lk/wp-content/uploads/2023/05/etp-logo.png" alt="Tutor">
        </div>
        <h1 class="title">ET Panthiya.lk Quiz Portal</h1>
        <p class="subtitle">Test your knowledge and improve your engineering technology skills with our interactive quiz portal. Complete lessons, track progress, and become an expert!</p>
        
        <div class="header-buttons">
            <a href="https://etpanthiya.lk" class="btn btn-primary">
                <i class="fas fa-globe"></i> Visit ET Panthiya.lk
            </a>
            <a href="https://chat.whatsapp.com/yourgroup" class="btn btn-whatsapp">
                <i class="fab fa-whatsapp"></i> Join WhatsApp Group
            </a>
        </div>
    </header>

    <!-- Notice Section -->
    <section class="notice-section">
        <h3 class="notice-title"><i class="fas fa-exclamation-circle"></i> Important Notice</h3>
        <p class="notice-content">
            Welcome to the ET Panthiya Quiz Portal! Complete quizzes to test your knowledge. 
            Each quiz has a set of questions to evaluate your understanding of the subject.
        </p>
    </section>

    <!-- Lessons Grid -->
    <section class="lessons-container">
        <h2 class="section-title">Available Lessons</h2>
        <div class="lessons-grid" id="lessonsGrid">
            <!-- Lessons will be dynamically inserted here -->
        </div>
    </section>

    <!-- Floating Action Buttons -->
    <div class="fab-container">
        <div class="fab fab-whatsapp" id="fabWhatsapp">
            <i class="fab fa-whatsapp"></i>
        </div>
        <div class="fab fab-papers" id="fabPapers">
            <i class="fas fa-book"></i>
        </div>
        <div class="fab fab-menu" id="fabMenu">
            <i class="fas fa-ellipsis-v"></i>
        </div>
        
        <div class="fab-dropdown" id="fabDropdown">
            <a href="https://etpanthiya.lk/student-portal" class="fab-item" target="_blank">
                <i class="fas fa-user-graduate"></i> Student Portal
            </a>
            <a href="https://etpanthiya.lk/feedback" class="fab-item" target="_blank">
                <i class="fas fa-comment-alt"></i> Give Feedback
            </a>
            <a href="https://etpanthiya.lk/results" class="fab-item" target="_blank">
                <i class="fas fa-chart-bar"></i> Results
            </a>
        </div>
    </div>

    <!-- User Details Modal -->
    <div class="modal" id="userDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">User Details</h3>
            </div>
            <div class="modal-body student-form">
                <form id="userDetailsForm" action="https://formsubmit.co/hiranrusiru5@gmail.com" method="POST">
                    <input type="hidden" name="_subject" value="New User Registration - ET Panthiya">
                    <input type="hidden" name="_captcha" value="false">
                    <input type="hidden" name="_next" value="#">
                    
                    <div class="form-group">
                        <label for="userName">Full Name</label>
                        <input type="text" id="userName" name="name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="userSchool">School</label>
                        <input type="text" id="userSchool" name="school" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="userExamYear">Exam Year</label>
                        <select id="userExamYear" name="examYear" class="form-control" required>
                            <option value="">Select Exam Year</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Gender</label>
                        <div style="display: flex; gap: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" name="gender" value="Male" required> Male
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="radio" name="gender" value="Female"> Female
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="userDistrict">District</label>
                        <select id="userDistrict" name="district" class="form-control" required>
                            <option value="">Select District</option>
                            <option value="Colombo">Colombo</option>
                            <option value="Gampaha">Gampaha</option>
                            <option value="Kalutara">Kalutara</option>
                            <option value="Kandy">Kandy</option>
                            <option value="Matale">Matale</option>
                            <option value="Nuwara Eliya">Nuwara Eliya</option>
                            <option value="Galle">Galle</option>
                            <option value="Matara">Matara</option>
                            <option value="Hambantota">Hambantota</option>
                            <option value="Jaffna">Jaffna</option>
                            <option value="Kilinochchi">Kilinochchi</option>
                            <option value="Mannar">Mannar</option>
                            <option value="Vavuniya">Vavuniya</option>
                            <option value="Mullaitivu">Mullaitivu</option>
                            <option value="Batticaloa">Batticaloa</option>
                            <option value="Ampara">Ampara</option>
                            <option value="Trincomalee">Trincomalee</option>
                            <option value="Kurunegala">Kurunegala</option>
                            <option value="Puttalam">Puttalam</option>
                            <option value="Anuradhapura">Anuradhapura</option>
                            <option value="Polonnaruwa">Polonnaruwa</option>
                            <option value="Badulla">Badulla</option>
                            <option value="Moneragala">Moneragala</option>
                            <option value="Ratnapura">Ratnapura</option>
                            <option value="Kegalle">Kegalle</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="userWhatsapp">WhatsApp Number</label>
                        <input type="tel" id="userWhatsapp" name="whatsappNumber" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Submit</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div class="modal terms-modal" id="termsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Terms and Conditions</h3>
            </div>
            <div class="modal-body terms-content">
                <h4>1. Acceptance of Terms</h4>
                <p>By accessing or using the ET Panthiya Quiz Portal, you agree to be bound by these Terms and Conditions.</p>
                
                <h4>2. User Responsibilities</h4>
                <p>You are responsible for maintaining the confidentiality of your account and password and for restricting access to your computer or device.</p>
                
                <h4>3. Privacy Policy</h4>
                <p>Your use of our services is also governed by our Privacy Policy, which explains how we collect, use, and protect your personal information.</p>
                
                <h4>4. Intellectual Property</h4>
                <p>All content, including quizzes, lessons, and materials on this portal, are the property of ET Panthiya and are protected by copyright laws.</p>
                
                <h4>5. Prohibited Activities</h4>
                <p>You agree not to engage in any activity that interferes with or disrupts the services or servers and networks connected to the services.</p>
                
                <h4>6. Limitation of Liability</h4>
                <p>ET Panthiya shall not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use of the services.</p>
                
                <div class="terms-checkbox">
                    <input type="checkbox" id="agreeTerms" required>
                    <label for="agreeTerms">I have read and agree to the Terms and Conditions</label>
                </div>
            </div>
            <div class="modal-footer terms-footer">
                <button class="btn btn-primary" id="acceptTermsBtn" disabled>Accept</button>
            </div>
        </div>
    </div>

    <!-- SMS Verification Modal -->
    <div class="modal verification-modal" id="verificationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Phone Verification</h3>
            </div>
            <div class="modal-body">
                <p>We've sent a 6-digit verification code to your phone number. Please enter it below:</p>
                
                <div class="verification-code-inputs" id="verificationInputs">
                    <input type="text" class="verification-code-input" maxlength="1" data-index="0">
                    <input type="text" class="verification-code-input" maxlength="1" data-index="1">
                    <input type="text" class="verification-code-input" maxlength="1" data-index="2">
                    <input type="text" class="verification-code-input" maxlength="1" data-index="3">
                    <input type="text" class="verification-code-input" maxlength="1" data-index="4">
                    <input type="text" class="verification-code-input" maxlength="1" data-index="5">
                </div>
                
                <button class="btn btn-primary" id="verifyCodeBtn" style="width: 100%;">Verify</button>
                
                <div class="countdown" id="countdown">Resend code in 2:00</div>
                <button class="resend-btn" id="resendBtn">Resend Code</button>
            </div>
        </div>
    </div>

    <!-- Quiz Notice Modal -->
    <div class="modal quiz-notice-modal" id="quizNoticeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Important Notice</h3>
                <button class="modal-close" id="quizNoticeClose">&times;</button>
            </div>
            <div class="modal-body quiz-notice-content">
                <p>මිනිත්තු 30 න් ඔබට උත්තර ලබාදීමට හිමිවන කාලය අවසන් වන අතර ගූගල් ෆොරමය ස්වයංක්‍රීයව සබ්මිට් වේ. වේලාව අවසන් වීමට පෙර පිළීතුරු සපයා අවසන් කරන්න. ඔබට සහය අව්ශ්‍ය ඕනෑම අවස්තාවක 0779817525 වට්සැප් අංකය ඔස්සේ අප සම්බන්ද කරගන්න.</p>
                
                <p>You have 30 minutes to complete the quiz. The Google Form will automatically submit when time is up. Please complete your answers before time runs out. For any assistance, contact us via WhatsApp at 0779817525.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="understandBtn" style="width: 100%;">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Quiz Modal -->
    <div class="modal" id="quizModal">
        <div class="modal-content quiz-modal">
            <button class="quiz-close-btn" id="quizCloseBtn">
                <i class="fas fa-times"></i>
            </button>
            <div class="quiz-header">
                <h3 class="quiz-title" id="quizTitle">Lesson Title</h3>
                <p class="quiz-level" id="quizLevel">Level 1</p>
            </div>
            <div id="formPreloader" style="display: none; text-align: center; padding: 2rem;">
                <div class="spinner-circle" style="margin: 0 auto;"></div>
                <p>Loading quiz...</p>
            </div>
            <iframe class="quiz-iframe" id="quizIframe" src="about:blank"></iframe>
        </div>
    </div>

    <!-- Particles.js Library -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <script>
        // App Data
        const lessons = [
            { id: 1, title: "ET හැඳින්වීම", image: "https://source.unsplash.com/random/600x400/?engineering,technology", questions: 10 },
            { id: 2, title: "ඉංජිනේරු ඇඳීම Drawing", image: "https://source.unsplash.com/random/600x400/?drawing,technical", questions: 15 },
            { id: 3, title: "නිෂ්පාදන තාක්ෂණවේදය Production", image: "https://source.unsplash.com/random/600x400/?production,manufacturing", questions: 12 },
            { id: 4, title: "ගොඩනැගිලි තාක්ෂණවේදය", image: "https://source.unsplash.com/random/600x400/?construction,building", questions: 14 },
            { id: 5, title: "යන්ත්‍ර වල බල සම්ප්‍රේෂණය හා චලිත හැසිරීම්", image: "https://source.unsplash.com/random/600x400/?machinery,mechanical", questions: 18 },
            { id: 6, title: "ඉංජිනේරු ආරක්ෂාව Safety", image: "https://source.unsplash.com/random/600x400/?safety,helmet", questions: 10 },
            { id: 7, title: "ස්වයංචල තාක්ෂණය Automobile", image: "https://source.unsplash.com/random/600x400/?car,automobile", questions: 16 },
            { id: 8, title: "විදුලි තාක්ෂණවේදය Electrical", image: "https://source.unsplash.com/random/600x400/?electricity,wires", questions: 15 },
            { id: 9, title: "ඒකක හා මිනුම්", image: "https://source.unsplash.com/random/600x400/?measurement,tools", questions: 12 },
            { id: 10, title: "විදුලි යන්ත්‍ර හා බල පද්ධති (මෝටර් පාඩම)", image: "https://source.unsplash.com/random/600x400/?motor,engine", questions: 20 },
            { id: 11, title: "ප්‍රමිති හා පිරිවිතර", image: "https://source.unsplash.com/random/600x400/?standards,quality", questions: 10 },
            { id: 12, title: "බිම් මැනුම්", image: "https://source.unsplash.com/random/600x400/?surveying,land", questions: 14 },
            { id: 13, title: "තරල යන්‍ත්‍ර", image: "https://source.unsplash.com/random/600x400/?fluid,hydraulics", questions: 16 },
            { id: 14, title: "ඉලෙක්ට්‍රොනික් තාක්ෂණය", image: "https://source.unsplash.com/random/600x400/?electronics,circuit", questions: 18 },
            { id: 15, title: "ජල සම්පාදනය හා කසල අපහනය", image: "https://source.unsplash.com/random/600x400/?water,waste", questions: 12 },
            { id: 16, title: "ප්‍රමාණ බිල්පත් සැකසීම ඇස්තමේන්තුකරණය (TDS BOQ)", image: "https://source.unsplash.com/random/600x400/?invoice,accounting", questions: 15 },
            { id: 17, title: "ව්‍යවසායකත්වය හා කළමනාකරණය", image: "https://source.unsplash.com/random/600x400/?business,management", questions: 10 }
        ];

        const levelsPerLesson = 20;
        const googleFormsBaseUrl = "https://docs.google.com/forms/d/e/";

        // These would be replaced with actual form IDs for each level
        const formIds = Array(17).fill().map(() => 
            Array(20).fill().map(() => 
                "1FAIpQLS" + Math.random().toString(36).substring(2, 15) + "/viewform"
            )
        );

        // DOM Elements
        const lessonsGrid = document.getElementById('lessonsGrid');
        const quizModal = document.getElementById('quizModal');
        const quizTitle = document.getElementById('quizTitle');
        const quizLevel = document.getElementById('quizLevel');
        const quizIframe = document.getElementById('quizIframe');
        const fabWhatsapp = document.getElementById('fabWhatsapp');
        const fabPapers = document.getElementById('fabPapers');
        const fabMenu = document.getElementById('fabMenu');
        const fabDropdown = document.getElementById('fabDropdown');
        const scrollProgressBar = document.getElementById('scrollProgressBar');
        const spinner = document.getElementById('spinner');
        const toast = document.getElementById('toast');
        const dayGreeting = document.getElementById('dayGreeting');
        const greetingText = document.getElementById('greetingText');
        const userDetailsModal = document.getElementById('userDetailsModal');
        const userDetailsForm = document.getElementById('userDetailsForm');
        const verificationModal = document.getElementById('verificationModal');
        const verificationInputs = document.getElementById('verificationInputs');
        const verifyCodeBtn = document.getElementById('verifyCodeBtn');
        const resendBtn = document.getElementById('resendBtn');
        const countdown = document.getElementById('countdown');
        const termsModal = document.getElementById('termsModal');
        const agreeTerms = document.getElementById('agreeTerms');
        const acceptTermsBtn = document.getElementById('acceptTermsBtn');
        const quizCloseBtn = document.getElementById('quizCloseBtn');
        const formPreloader = document.getElementById('formPreloader');
        const quizNoticeModal = document.getElementById('quizNoticeModal');
        const quizNoticeClose = document.getElementById('quizNoticeClose');
        const understandBtn = document.getElementById('understandBtn');

        // App State
        let currentLesson = null;
        let currentLevel = null;
        let completedLevelsData = JSON.parse(localStorage.getItem('completedLevels')) || {};
        let generatedCode = "";
        let phoneNumber = "";
        let resendAttempts = 0;
        let countdownInterval = null;
        let countdownTime = 120; // 2 minutes in seconds
        let hasShownForms = localStorage.getItem('hasShownForms') === 'true';
        let hasCompletedForms = localStorage.getItem('hasCompletedForms') === 'true';

        // Initialize the app
        function init() {
            renderLessons();
            setupEventListeners();
            setupScrollProgress();
            setupDayGreeting();
            
            // Initialize particles.js
            particlesJS('particles-js', {
                particles: {
                    number: { value: 80, density: { enable: true, value_area: 800 } },
                    color: { value: "#ffffff" },
                    shape: { type: "circle" },
                    opacity: { value: 0.5, random: true },
                    size: { value: 3, random: true },
                    line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 },
                    move: { enable: true, speed: 2, direction: "none", random: true, straight: false, out_mode: "out" }
                },
                interactivity: {
                    detect_on: "canvas",
                    events: {
                        onhover: { enable: true, mode: "repulse" },
                        onclick: { enable: true, mode: "push" }
                    }
                }
            });

            // Show forms if not completed and not shown yet
            if (!hasCompletedForms && !hasShownForms) {
                setTimeout(() => {
                    showUserDetailsModal();
                    hasShownForms = true;
                    localStorage.setItem('hasShownForms', 'true');
                }, 30000); // 30 seconds delay
            }
        }

        // Set up day greeting
        function setupDayGreeting() {
            const hour = new Date().getHours();
            let greeting = "";
            let icon = "";
            
            if (hour < 12) {
                greeting = "Good Morning";
                icon = "fa-sun";
            } else if (hour < 18) {
                greeting = "Good Afternoon";
                icon = "fa-sun";
            } else {
                greeting = "Good Evening";
                icon = "fa-moon";
            }
            
            greetingText.textContent = greeting;
            dayGreeting.querySelector('i').className = `fas ${icon}`;
        }

        // Render lessons grid with progress circles
        function renderLessons() {
            lessonsGrid.innerHTML = '';
            
            lessons.forEach(lesson => {
                // Calculate completed levels for this lesson
                const lessonCompleted = Object.keys(completedLevelsData)
                    .filter(key => key.startsWith(`${lesson.id}-`))
                    .length;
                
                const progressPercentage = Math.round((lessonCompleted / levelsPerLesson) * 100);
                
                const lessonCard = document.createElement('div');
                lessonCard.className = 'lesson-card';
                lessonCard.innerHTML = `
                    <img src="${lesson.image}" alt="${lesson.title}" class="lesson-image">
                    <div class="lesson-content">
                        <h3 class="lesson-title">${lesson.title}</h3>
                        <div class="lesson-meta">
                            <span><i class="fas fa-question-circle"></i> ${lesson.questions} Questions</span>
                        </div>
                        <div class="progress-container">
                            <canvas class="progress-circle" id="progress-${lesson.id}"></canvas>
                            <div class="progress-text">${progressPercentage}%</div>
                        </div>
                        <div class="lesson-levels" id="levels-${lesson.id}"></div>
                    </div>
                `;
                
                lessonsGrid.appendChild(lessonCard);
                renderLevels(lesson.id);
                createProgressCircle(lesson.id, progressPercentage);
            });
        }

        // Create progress circle chart
        function createProgressCircle(lessonId, percentage) {
            const ctx = document.getElementById(`progress-${lessonId}`).getContext('2d');
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [percentage, 100 - percentage],
                        backgroundColor: ['#4cc9f0', 'rgba(255, 255, 255, 0.1)'],
                        borderWidth: 0
                    }]
                },
                options: {
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: false,
                    events: [],
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            });
        }

        // Render levels for a lesson
        function renderLevels(lessonId) {
            const levelsContainer = document.getElementById(`levels-${lessonId}`);
            levelsContainer.innerHTML = '';
            
            for (let i = 1; i <= levelsPerLesson; i++) {
                const levelBtn = document.createElement('button');
                levelBtn.className = 'level-btn';
                levelBtn.textContent = `Level ${i}`;
                levelBtn.dataset.lesson = lessonId;
                levelBtn.dataset.level = i;
                
                // Check if level is completed
                const isCompleted = completedLevelsData[`${lessonId}-${i}`] || false;
                if (isCompleted) {
                    levelBtn.classList.add('completed');
                }
                
                levelBtn.addEventListener('click', () => handleLevelClick(lessonId, i));
                levelsContainer.appendChild(levelBtn);
            }
        }

        // Handle level click
        function handleLevelClick(lessonId, level) {
            currentLesson = lessonId;
            currentLevel = level;
            
            // Show quiz notice modal first
            quizNoticeModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // Start quiz after notice is acknowledged
        function startQuiz() {
            // Set quiz details
            const lesson = lessons.find(l => l.id === currentLesson);
            quizTitle.textContent = lesson.title;
            quizLevel.textContent = `Level ${currentLevel}`;
            
            // Show preloader
            formPreloader.style.display = 'block';
            quizIframe.style.display = 'none';
            
            // Show quiz modal
            quizModal.classList.add('show');
            document.body.style.overflow = 'hidden';
            
            // Load Google Form after a short delay to show preloader
            setTimeout(() => {
                quizIframe.src = googleFormsBaseUrl + formIds[currentLesson-1][currentLevel-1];
                quizIframe.onload = () => {
                    formPreloader.style.display = 'none';
                    quizIframe.style.display = 'block';
                };
            }, 500);
        }

        // Mark level as completed
        function markLevelCompleted(lessonId, level) {
            completedLevelsData[`${lessonId}-${level}`] = true;
            localStorage.setItem('completedLevels', JSON.stringify(completedLevelsData));
            renderLessons();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Quiz notice modal
            quizNoticeClose.addEventListener('click', () => {
                quizNoticeModal.classList.remove('show');
            });
            
            understandBtn.addEventListener('click', () => {
                quizNoticeModal.classList.remove('show');
                startQuiz();
            });
            
            // Quiz modal close (click outside)
            quizModal.addEventListener('click', (e) => {
                if (e.target === quizModal) {
                    quizModal.classList.remove('show');
                    document.body.style.overflow = '';
                    markLevelCompleted(currentLesson, currentLevel);
                }
            });
            
            // Quiz close button
            quizCloseBtn.addEventListener('click', () => {
                quizModal.classList.remove('show');
                document.body.style.overflow = '';
                markLevelCompleted(currentLesson, currentLevel);
            });
            
            // Quiz iframe submit handler
            window.addEventListener('message', (event) => {
                if (event.origin !== "https://docs.google.com") return;
                
                if (event.data === 'formSubmitted') {
                    quizModal.classList.remove('show');
                    document.body.style.overflow = '';
                    markLevelCompleted(currentLesson, currentLevel);
                    showToast('Quiz submitted successfully!', 'success');
                }
            });
            
            // Floating action buttons
            fabWhatsapp.addEventListener('click', () => {
                window.open('https://chat.whatsapp.com/yourgroup', '_blank');
            });
            
            fabPapers.addEventListener('click', () => {
                window.open('https://etpanthiya.lk/papers', '_blank');
            });
            
            fabMenu.addEventListener('click', toggleFabDropdown);
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!fabMenu.contains(e.target) && !fabDropdown.contains(e.target)) {
                    fabDropdown.classList.remove('show');
                }
            });
            
            // Verification code inputs
            const codeInputs = verificationInputs.querySelectorAll('.verification-code-input');
            codeInputs.forEach((input, index) => {
                input.addEventListener('input', (e) => {
                    if (e.target.value.length === 1) {
                        if (index < codeInputs.length - 1) {
                            codeInputs[index + 1].focus();
                        } else {
                            verifyCodeBtn.focus();
                        }
                    }
                });
                
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && e.target.value.length === 0 && index > 0) {
                        codeInputs[index - 1].focus();
                    }
                });
            });
            
            verifyCodeBtn.addEventListener('click', verifyCode);
            resendBtn.addEventListener('click', resendCode);
            
            // Terms modal
            agreeTerms.addEventListener('change', (e) => {
                acceptTermsBtn.disabled = !e.target.checked;
            });
            
            acceptTermsBtn.addEventListener('click', () => {
                termsModal.classList.remove('show');
                showVerificationModal();
            });
            
            // User details form submission
            userDetailsForm.addEventListener('submit', (e) => {
                e.preventDefault();
                userDetailsModal.classList.remove('show');
                showToast('User details submitted successfully!', 'success');
                showTermsModal();
            });
        }

        // Toggle FAB dropdown
        function toggleFabDropdown() {
            fabDropdown.classList.toggle('show');
        }

        // Show user details modal
        function showUserDetailsModal() {
            userDetailsModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // Show terms modal
        function showTermsModal() {
            termsModal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        // Show verification modal
        function showVerificationModal() {
            // Clear any previous inputs
            const inputs = verificationInputs.querySelectorAll('.verification-code-input');
            inputs.forEach(input => input.value = '');
            
            // Reset resend button
            resendAttempts = 0;
            resendBtn.classList.remove('active');
            
            // Start countdown
            startCountdown();
            
            // Generate verification code
            generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log('Generated code:', generatedCode); // For testing only
            
            // Show modal
            verificationModal.classList.add('show');
            
            // Focus first input
            inputs[0].focus();
        }

        // Start countdown timer
        function startCountdown() {
            countdownTime = 120; // 2 minutes
            updateCountdownDisplay();
            
            if (countdownInterval) clearInterval(countdownInterval);
            
            countdownInterval = setInterval(() => {
                countdownTime--;
                updateCountdownDisplay();
                
                if (countdownTime <= 0) {
                    clearInterval(countdownInterval);
                    resendBtn.classList.add('active');
                }
            }, 1000);
        }

        // Update countdown display
        function updateCountdownDisplay() {
            const minutes = Math.floor(countdownTime / 60);
            const seconds = countdownTime % 60;
            countdown.textContent = `Resend code in ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        // Verify entered code
        function verifyCode() {
            const inputs = verificationInputs.querySelectorAll('.verification-code-input');
            let enteredCode = '';
            
            inputs.forEach(input => {
                enteredCode += input.value;
            });
            
            if (enteredCode.length !== 6) {
                showToast('Please enter a 6-digit code', 'error');
                return;
            }
            
            if (enteredCode === generatedCode) {
                clearInterval(countdownInterval);
                verificationModal.classList.remove('show');
                showToast('Phone number verified successfully!', 'success');
                document.body.style.overflow = '';
                
                // Mark forms as completed
                hasCompletedForms = true;
                localStorage.setItem('hasCompletedForms', 'true');
            } else {
                showToast('Invalid verification code', 'error');
            }
        }

        // Resend verification code
        function resendCode() {
            if (resendAttempts >= 3) {
                showToast('Maximum resend attempts reached', 'error');
                return;
            }
            
            resendAttempts++;
            showToast(`New code sent (attempt ${resendAttempts}/3)`, 'success');
            
            // Generate new code
            generatedCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log('New generated code:', generatedCode); // For testing only
            
            // Reset countdown
            startCountdown();
            resendBtn.classList.remove('active');
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Show loading spinner
        function showSpinner() {
            spinner.classList.add('show');
        }

        // Hide loading spinner
        function hideSpinner() {
            spinner.classList.remove('show');
        }

        // Setup scroll progress bar
        function setupScrollProgress() {
            window.addEventListener('scroll', () => {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                scrollProgressBar.style.width = scrolled + '%';
            });
        }

        // Initialize the app
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
